define("block_grade_activity/grade_handler",["exports","core/ajax","core/notification","core/toast","core/str"],function(_exports,_ajax,_notification,_toast,_str){function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}
/**
   * AMD module for block_grade_activity.
   *
   * Handles:
   *  - Search / filtering of the student table.
   *  - "Dirty" detection to enable / disable the Save button.
   *  - AJAX calls to enable_grading and save_grades web-service functions.
   *  - Toast notification on success.
   *
   * @module     block_grade_activity/grade_handler
   * @copyright  2025 Your Name
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initSetup=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.initSetup=cmid=>{const container=document.querySelector(".block_grade_activity_setup");if(!container)return;const enableBtn=container.querySelector("#grade-activity-enable");enableBtn&&enableBtn.addEventListener("click",()=>{enableBtn.disabled=!0,enableBtn.textContent="â€¦",_ajax.default.call([{methodname:"block_grade_activity_enable_grading",args:{cmid:cmid},done:()=>{window.location.reload()},fail:err=>{enableBtn.disabled=!1,_notification.default.exception(err)}}])})};_exports.init=(cmid,grademax)=>{const container=document.querySelector(".block_grade_activity_grading");if(!container)return;const searchInput=container.querySelector("#grade-activity-search"),saveButton=container.querySelector("#grade-activity-save"),gradeInputs=container.querySelectorAll(".grade-input");if(!saveButton||0===gradeInputs.length)return;const originalValues=new Map;gradeInputs.forEach(input=>{originalValues.set(input.dataset.userid,input.value)}),searchInput&&searchInput.addEventListener("input",()=>{const query=searchInput.value.trim().toLowerCase();container.querySelectorAll("#grade-activity-table tbody tr").forEach(row=>{const nameCell=row.querySelector(".student-name");if(!nameCell)return;const name=nameCell.textContent.toLowerCase();row.hidden=""!==query&&!name.includes(query)})});const checkDirty=()=>{let dirty=!1;gradeInputs.forEach(input=>{input.value!==originalValues.get(input.dataset.userid)&&(dirty=!0)}),saveButton.disabled=!dirty};gradeInputs.forEach(input=>{input.addEventListener("input",checkDirty)});const isValidGrade=val=>{if(""===val)return!0;const num=parseFloat(val);return!isNaN(num)&&num>=0&&num<=grademax};gradeInputs.forEach(input=>{input.addEventListener("blur",()=>{isValidGrade(input.value)?input.classList.remove("is-invalid"):input.classList.add("is-invalid")})}),saveButton.addEventListener("click",async()=>{const grades=[];let hasInvalid=!1;if(gradeInputs.forEach(input=>{const uid=input.dataset.userid;if(input.value!==originalValues.get(uid)&&""!==input.value)return isValidGrade(input.value)?void grades.push({userid:parseInt(uid,10),grade:parseFloat(input.value)}):(hasInvalid=!0,void input.classList.add("is-invalid"))}),hasInvalid){const msg=await(0,_str.get_string)("invalidgrade","block_grade_activity",grademax);return void _notification.default.addNotification({message:msg,type:"error"})}if(0===grades.length)return;saveButton.disabled=!0;const originalLabel=saveButton.textContent;saveButton.textContent=await(0,_str.get_string)("saving","block_grade_activity"),_ajax.default.call([{methodname:"block_grade_activity_save_grades",args:{cmid:cmid,grades:grades},done:async()=>{gradeInputs.forEach(input=>{originalValues.set(input.dataset.userid,input.value)}),saveButton.textContent=originalLabel,saveButton.disabled=!0;const successMsg=await(0,_str.get_string)("gradessaved","block_grade_activity");(0,_toast.add)(successMsg)},fail:err=>{saveButton.textContent=originalLabel,checkDirty(),_notification.default.exception(err)}}])})}});

//# sourceMappingURL=grade_handler.min.js.map